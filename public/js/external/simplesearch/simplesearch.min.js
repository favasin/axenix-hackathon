const input=document.getElementById("elbi-input"),results=document.getElementById("elbi-results"),request=new Request("/index.json"),display_score=!1,display_counter=!0,snippet_lenght=200;fetch(request).then(e=>e.json()).then(e=>{let n=e;var t;input.addEventListener("input",function(){clearTimeout(t),t=setTimeout(()=>{let e=n;if(input.value!=""){e.forEach(function(e){e.score=0,e.toSearchResult=!1,e.chapter=parseInt(e.relpermalink.substring(1,3))});let n=input.value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g);n.forEach(function(t){t!=""&&(t=t.replaceAll('"',""),e=e.filter(function(e){let n=JSON.stringify(e);return n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().indexOf(t.toLowerCase())!==-1}))}),n.forEach(function(t){t!=""&&(t=t.replaceAll('"',""),e.forEach(function(e){isNaN(e.chapter)||(e.chapter=e.chapter*-1,e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(t.toLowerCase())&&(e.score+=3,e.toSearchResult=!0),JSON.stringify(e.tags).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(t.toLowerCase())&&(e.score+=2,e.toSearchResult=!0),e.content.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(t.toLowerCase())&&(e.score+=1,e.toSearchResult=!0),JSON.stringify(e.categories).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(t.toLowerCase())&&(e.score+=1,e.toSearchResult=!0),e.score+=e.chapter)}))}),e=e.filter(function(e){return e.toSearchResult}),e.sort(function(e,t){const n=e.title.toLowerCase(),s=t.title.toLowerCase();return n<s?-1:n>s?1:0}),e.sort((e,t)=>t.score-e.score);var t=1;results.innerHTML="",display_counter&&results.insertAdjacentHTML("beforeend","<p>Всего найдено: "+e.length+" результатов.</p>"),e.forEach(function(e){var s,a,r,o=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),c=e.content.normalize("NFD").replace(/[\u0300-\u036f]/g,""),i=JSON.stringify(e.tags).normalize("NFD").replace(/[\u0300-\u036f]/g,""),l="";n.forEach(function(e){if(e=e.replaceAll('"',""),a=o.toLowerCase().indexOf(e.toLowerCase()),a>-1&&(o=o.replace(o.substring(a,a+e.length),"<mark>"+o.substring(a,a+e.length)+"</mark>")),s=c.toLowerCase().indexOf(e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),s>-1){var t=c.replace(c.substring(s,s+e.length),"<mark>"+c.substring(s,s+e.length)+"</mark>");l=l+t.slice(s>snippet_lenght?s-snippet_lenght:s,s+e.length+snippet_lenght)+"<hr>"}r=i.toLowerCase().indexOf(e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),r>-1&&(i=i.replace(i.substring(r,r+e.length),"<mark>"+i.substring(r,r+e.length)+"</mark>"))}),display_counter&&(results.insertAdjacentHTML("beforeend","<p>№ "+t+"</p>"),t+=1),results.insertAdjacentHTML("beforeend","<li class='elbi-results-item'><h2 style='font-size: 1.5rem;'><a href='"+e.relpermalink+"'>"+o+"</a></h2><p>"+l+"</p><p style='margin-top: 5px'>Tagged: <strong>"+i+"</strong></p></li>"),display_score&&results.insertAdjacentHTML("beforeend","<p>Result score: "+e.score+"</p>")})}},1e3)})})