<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Модель данных и базы данных on Сервис генерации презентаций</title><link>https://example.org/03_backend/01_info_models/</link><description>Recent content in Модель данных и базы данных on Сервис генерации презентаций</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><atom:link href="https://example.org/03_backend/01_info_models/index.xml" rel="self" type="application/rss+xml"/><item><title>Реляционные таблицы (PostgreSQL)</title><link>https://example.org/03_backend/01_info_models/relational/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://example.org/03_backend/01_info_models/relational/</guid><description>Реляционные таблицы PostgreSQL 16# Схема: public (Free/Pro) / tenant_{id} (Enterprise) Расширения: uuid-ossp, pgcrypto, pg_trgm, btree_gin
Enum-типы (глобальные)# CREATE TYPE org_role AS ENUM (&amp;#39;admin&amp;#39;, &amp;#39;editor&amp;#39;, &amp;#39;viewer&amp;#39;); CREATE TYPE oauth_provider AS ENUM (&amp;#39;google&amp;#39;, &amp;#39;microsoft&amp;#39;, &amp;#39;notion&amp;#39;, &amp;#39;confluence&amp;#39;); CREATE TYPE subscription_status AS ENUM (&amp;#39;active&amp;#39;, &amp;#39;trialing&amp;#39;, &amp;#39;past_due&amp;#39;, &amp;#39;canceled&amp;#39;, &amp;#39;expired&amp;#39;); CREATE TYPE presentation_status AS ENUM (&amp;#39;draft&amp;#39;, &amp;#39;outline_ready&amp;#39;, &amp;#39;generating&amp;#39;, &amp;#39;ready&amp;#39;, &amp;#39;error&amp;#39;); CREATE TYPE tone_type AS ENUM (&amp;#39;formal&amp;#39;, &amp;#39;business&amp;#39;, &amp;#39;persuasive&amp;#39;, &amp;#39;technical&amp;#39;, &amp;#39;educational&amp;#39;, &amp;#39;friendly&amp;#39;); CREATE TYPE slide_type AS ENUM (&amp;#39;title_slide&amp;#39;, &amp;#39;content&amp;#39;, &amp;#39;chart&amp;#39;, &amp;#39;table&amp;#39;, &amp;#39;image&amp;#39;, &amp;#39;quote&amp;#39;, &amp;#39;divider&amp;#39;); CREATE TYPE slide_status AS ENUM (&amp;#39;pending&amp;#39;, &amp;#39;generating&amp;#39;, &amp;#39;ready&amp;#39;, &amp;#39;error&amp;#39;); CREATE TYPE source_file_type AS ENUM (&amp;#39;pdf&amp;#39;, &amp;#39;docx&amp;#39;, &amp;#39;xlsx&amp;#39;, &amp;#39;csv&amp;#39;, &amp;#39;pptx&amp;#39;, &amp;#39;url&amp;#39;, &amp;#39;image&amp;#39;, &amp;#39;txt&amp;#39;); CREATE TYPE ingestion_status AS ENUM (&amp;#39;pending&amp;#39;, &amp;#39;processing&amp;#39;, &amp;#39;indexed&amp;#39;, &amp;#39;failed&amp;#39;); CREATE TYPE job_status AS ENUM (&amp;#39;pending&amp;#39;, &amp;#39;running&amp;#39;, &amp;#39;completed&amp;#39;, &amp;#39;failed&amp;#39;, &amp;#39;retrying&amp;#39;); CREATE TYPE llm_provider AS ENUM (&amp;#39;claude&amp;#39;, &amp;#39;gpt4o&amp;#39;, &amp;#39;llama3&amp;#39;, &amp;#39;gemini&amp;#39;); CREATE TYPE export_format AS ENUM (&amp;#39;pptx&amp;#39;, &amp;#39;pdf&amp;#39;, &amp;#39;google_slides&amp;#39;, &amp;#39;png&amp;#39;, &amp;#39;web&amp;#39;); CREATE TYPE share_access AS ENUM (&amp;#39;view&amp;#39;, &amp;#39;comment&amp;#39;, &amp;#39;edit&amp;#39;); CREATE TYPE webhook_status AS ENUM (&amp;#39;pending&amp;#39;, &amp;#39;delivered&amp;#39;, &amp;#39;failed&amp;#39;, &amp;#39;abandoned&amp;#39;); Таблица: users# Домен: Auth Назначение: Учётные записи пользователей системы.</description></item><item><title>Документные коллекции</title><link>https://example.org/03_backend/01_info_models/documents/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://example.org/03_backend/01_info_models/documents/</guid><description>Документные коллекции# Хранилище: MongoDB 7.0 / PostgreSQL JSONB (альтернатива) Назначение: Полуструктурированные данные с высокой вариативностью схемы: трейсы AI-генерации, аналитика просмотров, шаблоны промптов.
Эти коллекции хранят данные, которые плохо ложатся в реляционную модель: вложенные объекты с переменным числом полей, большие JSON-деревья состояний LangGraph-пайплайна, потоковые события аналитики.
Коллекция: generation_traces# Назначение: Полный трейс выполнения LangGraph-пайплайна генерации — каждый узел, prompt, ответ LLM, retrieval results, postprocessing.
Схема документа# interface GenerationTrace { _id: ObjectId; generation_job_id: string; // UUID, FK → generation_jobs.</description></item><item><title>Векторное хранилище (Qdrant)</title><link>https://example.org/03_backend/01_info_models/vector_store/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://example.org/03_backend/01_info_models/vector_store/</guid><description>Векторное хранилище: Qdrant# Версия Qdrant: 1.9+ Модель эмбеддингов: text-embedding-3-large (OpenAI) / BGE-M3 (on-premise) Размерность вектора: 3072 (text-embedding-3-large) / 1024 (BGE-M3) Метрика расстояния: Cosine similarity
Архитектура коллекций# Изоляция тенантов реализована через отдельную коллекцию на организацию:
org_{organization_id}_docs — документы организации Это обеспечивает:
Полную изоляцию данных (Enterprise требование) Независимое масштабирование коллекций Возможность удаления всех данных тенанта одной операцией graph TD subgraph Qdrant C1[&amp;#34;org_018e9a1f_docs\nTenant A&amp;#34;] C2[&amp;#34;org_029f0b2e_docs\nTenant B&amp;#34;] C3[&amp;#34;org_03a1c3f0_docs\nTenant C (Enterprise)&amp;#34;] end subgraph &amp;#34;RAG Service&amp;#34; RS[&amp;#34;Retrieval\nService&amp;#34;] ING[&amp;#34;Ingestion\nService&amp;#34;] end ING --&amp;gt;|&amp;#34;upsert vectors&amp;#34;| C1 ING --&amp;gt;|&amp;#34;upsert vectors&amp;#34;| C2 RS --&amp;gt;|&amp;#34;search(collection=org_{id})&amp;#34;| C1 RS --&amp;gt;|&amp;#34;search(collection=org_{id})&amp;#34;| C2 Схема записи (вектора/чанка)# interface DocumentChunk { // Идентификатор записи в Qdrant id: string; // UUID v4, совпадает с chunk_id в метаданных Qdrant // Вектор vector: number[]; // float32[3072] — text-embedding-3-large // Payload (метаданные, фильтруемые при поиске) payload: ChunkPayload; } interface ChunkPayload { // Привязка к источнику source_document_id: string; // UUID → source_documents.</description></item><item><title>Кэш и очереди (Redis)</title><link>https://example.org/03_backend/01_info_models/cache/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://example.org/03_backend/01_info_models/cache/</guid><description>Redis 7 — Кэш и очереди# Конфигурация: Redis 7 Cluster Mode (3 master + 3 replica) Политика вытеснения: allkeys-lru для кэш-узлов, noeviction для очередей Persistence: AOF (appendonly yes, fsync=everysec) + RDB snapshot каждые 15 мин
Ключ: session:{session_id}# Тип Redis: HASH
Схема значения:
interface CachedSession { user_id: string; // UUID пользователя organization_id: string; // UUID активной организации role: string; // Роль в организации: admin | editor | viewer email: string; // Email для быстрой идентификации plan: string; // Тарифный план: free | pro | team | enterprise created_at: string; // ISO 8601 timestamp last_active: string; // Последняя активность (обновляется при каждом запросе) ip: string; // IP при создании сессии } Пример:</description></item></channel></rss>