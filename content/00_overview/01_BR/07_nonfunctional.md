---
title: "Нефункциональные требования"
description: "Измеримые NFR по производительности, безопасности, надёжности, масштабируемости, совместимости, удобству и правовым аспектам."
weight: 7
draft: false
slug: ""
titleIcon: "fa-solid fa-gauge-high"
---

## Содержание

- [NFR-001 — NFR-005: Производительность](#производительность)
- [NFR-006 — NFR-008: Безопасность](#безопасность)
- [NFR-009 — NFR-012: Надёжность](#надёжность)
- [NFR-013 — NFR-015: Масштабируемость](#масштабируемость)
- [NFR-016 — NFR-017: Совместимость](#совместимость)
- [NFR-018 — NFR-019: Удобство](#удобство)
- [NFR-020 — NFR-022: Правовые и организационные](#правовые-и-организационные)
- [Матрица конфликтов NFR](#матрица-конфликтов-nfr)

---

## Производительность

#### NFR-001: Latency генерации outline

**Категория:** Производительность

**Формулировка:** p50 latency генерации outline (от POST `/presentations/{id}/generate/outline` до WebSocket-события `outline_generated`) ≤ 5 000 мс; p95 ≤ 10 000 мс; p99 ≤ 20 000 мс. Измеряется при нагрузке 50 concurrent generation requests.

**Критично для бизнеса:** Да — превышение 20 сек воспринимается пользователем как сбой; прямое влияние на CSAT и удержание.

**Метод проверки:** Нагрузочный тест (k6, 50 VU, 10 мин); трассировка через Jaeger; Prometheus histogram `generation_outline_duration_seconds`.

**Конфликты:** NFR-008 (полное audit logging каждого LLM-вызова добавляет ≈ 50 мс I/O). Компромисс: audit записывается асинхронно через Celery.

---

#### NFR-002: Latency генерации полной презентации

**Категория:** Производительность

**Формулировка:** p50 latency генерации 15 слайдов ≤ 30 000 мс; p95 ≤ 60 000 мс; p99 ≤ 120 000 мс. Измеряется при параллельной генерации до 3 слайдов одновременно. При `slide_count` > 15 — p95 пропорционально масштабируется: ≤ 4 000 мс × `slide_count`.

**Критично для бизнеса:** Да — NSM продукта «Время от загрузки данных до экспорта верифицированного слайда» целевое значение < 8 мин; p95 генерации 60 сек — необходимое условие.

**Метод проверки:** Нагрузочный тест (k6, 20 VU на генерацию, 30 мин); E2E-тест Playwright «upload → generate → export».

**Конфликты:** NFR-013 (горизонтальное масштабирование Generation Service требует ≥ 3 pods для параллелизации).

---

#### NFR-003: Latency экспорта PPTX

**Категория:** Производительность

**Формулировка:** p95 latency экспорта PPTX (15 слайдов) от POST `/export` до `export_jobs.status = completed` ≤ 15 000 мс. p95 экспорта PDF ≤ 25 000 мс.

**Критично для бизнеса:** Да — экспорт — завершающий шаг сценария; задержка > 30 сек снижает воспринимаемое качество сервиса.

**Метод проверки:** Нагрузочный тест (30 concurrent export tasks); Prometheus histogram `export_duration_seconds` по `format`.

**Конфликты:** Нет.

---

#### NFR-004: Latency API-эндпоинтов (CRUD)

**Категория:** Производительность

**Формулировка:** p95 latency синхронных CRUD-эндпоинтов (создание/чтение/обновление/удаление сущностей без генерации AI): ≤ 500 мс. p99 ≤ 1 000 мс. Включает: `/projects`, `/presentations` (не generate), `/brand-kits`, `/users`, `/organizations`.

**Критично для бизнеса:** Нет — не прямая функция генерации, но влияет на воспринимаемую отзывчивость UI.

**Метод проверки:** Нагрузочный тест (k6, 200 VU, GET-тяжёлый сценарий); Prometheus histogram по endpoint.

**Конфликты:** Нет.

---

#### NFR-005: Latency индексации документа

**Категория:** Производительность

**Формулировка:** p95 времени от загрузки файла до `ingestion_status = indexed`:
- Файл ≤ 5 МБ: ≤ 30 000 мс;
- Файл 5–50 МБ: ≤ 120 000 мс (асинхронно);
- Файл > 50 МБ: ≤ 300 000 мс (только Enterprise, асинхронно).

**Критично для бизнеса:** Да — индексация блокирует начало генерации; задержка > 5 мин нарушает UX flow.

**Метод проверки:** Нагрузочный тест: 20 concurrent ingestion workers, файлы разного размера; Prometheus histogram `ingestion_duration_seconds` по `file_size_bucket`.

**Конфликты:** NFR-014 (горизонтальное масштабирование Celery ingestion workers).

---

## Безопасность

#### NFR-006: Шифрование данных

**Категория:** Безопасность

**Формулировка:**
- **At-rest:** все данные в PostgreSQL, MongoDB, S3 шифруются AES-256 (disk/volume encryption).
- **In-transit:** TLS 1.3 обязателен для всех соединений клиент–сервер и сервис–сервис. TLS 1.2 запрещён.
- **Чувствительные поля:** `oauth_connections.access_token_encrypted`, `refresh_token_encrypted` шифруются на уровне приложения AES-256-GCM перед записью. Ключи — HashiCorp Vault / AWS KMS.
- **API-ключи:** хранится только SHA-256 хеш (`key_hash`). Plaintext-ключ не хранится нигде после выдачи.
- **Пароли пользователей:** bcrypt, work factor ≥ 12.

**Критично для бизнеса:** Да — требование GDPR, 152-ФЗ и Enterprise compliance. Без этого — невозможны корпоративные продажи.

**Метод проверки:** Аудит кода (код работы с токенами); сканер Trivy (docker images); тест: сырой SELECT из БД должен вернуть зашифрованный BYTEA, не токен.

**Конфликты:** NFR-001 (AES-256-GCM шифрование/расшифрование добавляет ≈ 1–3 мс per request). Приемлемо.

---

#### NFR-007: Аутентификация и авторизация

**Категория:** Безопасность

**Формулировка:**
- JWT access-token: срок жизни ≤ 15 минут.
- Refresh-token: срок жизни ≤ 7 дней, хранится только в httpOnly cookie (SameSite=Strict).
- Все endpoint (кроме `/share/{token}` и `/auth/*`) требуют валидного JWT.
- RBAC проверяется на уровне API Service до любой операции с данными.
- MFA (TOTP RFC 6238) обязателен для Enterprise-организаций.
- Максимум 5 неудачных попыток входа подряд → блокировка аккаунта на 15 минут.

**Критично для бизнеса:** Да — корпоративные данные пользователей.

**Метод проверки:** OWASP ZAP scan; unit-тест RBAC матрицы (все 15 комбинаций роль × действие); penetration test раз в 6 месяцев.

**Конфликты:** Нет.

---

#### NFR-008: Аудит и логирование

**Категория:** Безопасность

**Формулировка:**
- Каждое значимое действие (список: FR-049) записывается в `audit_logs` в течение ≤ 500 мс после выполнения (асинхронно через Celery).
- Записи хранятся ≥ 90 дней в PostgreSQL (партиционирование по месяцу); затем архивируются в S3 и хранятся ещё ≥ 270 дней (итого ≥ 1 год).
- `audit_logs` защищён от изменения и удаления: `UPDATE` и `DELETE` запрещены через политику PostgreSQL (grant revoke).
- `ip_address` хранится в открытом виде в `audit_logs` — только для сессий внутри системы; в `presentation_analytics` — только `ip_hash` (SHA-256 + salt, GDPR).

**Критично для бизнеса:** Да — требование GDPR, 152-ФЗ, а также будущего SOC 2 Type II.

**Метод проверки:** Аудит кода; попытка DELETE из `audit_logs` → должна получить permission denied; проверка наличия записи в лог в течение 500 мс после действия.

**Конфликты:** NFR-001 (асинхронная запись снимает конфликт с latency).

---

## Надёжность

#### NFR-009: Uptime сервиса

**Категория:** Надёжность

**Формулировка:** Uptime API Service ≥ 99.5% в месяц (≤ 3.65 ч простоя в месяц). Измеряется по HTTP healthcheck `/health` каждые 30 секунд из 3-х независимых регионов. Плановые работы (maintenance window) не включаются в расчёт при условии уведомления за ≥ 48 ч.

**Критично для бизнеса:** Да — платящие пользователи; недоступность = потеря доверия и чёрн.

**Метод проверки:** Prometheus `probe_success` (Blackbox Exporter); ежемесячный отчёт SLA в Grafana dashboard.

**Конфликты:** NFR-013 (rolling update без downtime требует ≥ 3 pods API Service с `maxUnavailable: 0`).

---

#### NFR-010: RTO и RPO PostgreSQL

**Категория:** Надёжность

**Формулировка:**
- **RPO (Recovery Point Objective) PostgreSQL:** ≤ 5 минут (continuous WAL archiving в S3).
- **RTO (Recovery Time Objective) PostgreSQL:** ≤ 30 минут (восстановление из snapshot + WAL replay).
- **RPO Redis:** ≤ 1 минута (AOF с fsync=everysec).
- **RTO Redis:** ≤ 15 минут (failover на replica через Redis Sentinel / ElastiCache automatic failover).
- **RPO Qdrant:** ≤ 6 часов (snapshot в S3 каждые 6 часов).
- **RTO Qdrant:** ≤ 60 минут (восстановление snapshot из S3).

**Критично для бизнеса:** Да — потеря данных презентаций = критический инцидент.

**Метод проверки:** Ежеквартальный DR drill: принудительное восстановление из backup в staging-среде с замером RTO.

**Конфликты:** Нет.

---

#### NFR-011: Устойчивость к отказу LLM-провайдера

**Категория:** Надёжность

**Формулировка:**
- Circuit Breaker: при error rate LLM API > 10% за скользящие 60 сек — автоматическое переключение с Claude Sonnet на GPT-4o fallback.
- Переключение происходит ≤ 30 сек (retry × 2 + failover).
- При недоступности обоих провайдеров (Claude + GPT-4o) — HTTP 503 с `retry_after: 60`; активные задачи генерации переводятся в статус `failed` с возможностью повторного запуска.
- Деградированный режим: при недоступности Qdrant — генерация только из промпта без RAG, с предупреждением пользователю «Поиск по источникам временно недоступен».

**Критично для бизнеса:** Да — недоступность LLM блокирует основную функцию.

**Метод проверки:** Chaos-тест (Chaos Mesh): имитация timeout Anthropic API → проверка автоматического failover за ≤ 30 сек; метрика `llm_fallback_triggered_total`.

**Конфликты:** NFR-001 (failover добавляет ≤ 30 сек к latency). Компромисс: пользователь видит прогресс-индикатор.

---

#### NFR-012: Качество AI-генерации

**Категория:** Надёжность (качество)

**Формулировка:**
- **HIR (Hallucination Incident Rate):** < 0.5 непомеченных галлюцинаций на 1 000 презентаций. Измеряется на выборке 100 презентаций в неделю ручной верификацией.
- **AI-детекция:** GPTZero классифицирует ≥ 70% сгенерированных текстовых блоков как «human-written» (P > 0.70).
- **Attribution coverage:** ≥ 90% числовых утверждений в слайдах имеют `source_refs` или `hallucination_flags`.

**Критично для бизнеса:** Да — ключевой дифференциатор продукта («ИИ-аналитик, не ИИ-дизайнер»).

**Метод проверки:** Еженедельная AI Quality выборка (GPTZero API + ручная оценка 2 аналитиков); dashboard метрики `avg_hallucination_flags_per_presentation` из generation_traces.

**Конфликты:** NFR-001 (постпроцессинг проверки фактов добавляет ≈ 500–1000 мс на слайд). Обоснован: качество > минимальная latency.

---

## Масштабируемость

#### NFR-013: Горизонтальное масштабирование

**Категория:** Масштабируемость

**Формулировка:**
- Система поддерживает горизонтальное масштабирование всех stateless-сервисов (API, RAG, Generation, Export) через добавление pod без изменения конфигурации.
- HPA триггеры:

| Сервис | Min pods | Max pods | Триггер |
|--------|----------|----------|---------|
| API Service | 3 | 10 | CPU > 60% |
| Generation Service | 3 | 8 | Queue depth > 50 |
| RAG Service | 2 | 6 | CPU > 70% |
| Celery Workers | 2 | 10 | Queue depth > 100 |
| Export Service | 2 | 4 | CPU > 70% |

- При масштабировании с DAU 500 до DAU 10 000 (20× рост за 12 мес.) — требуемый пиковый RPS 100–200 обслуживается без деградации latency выше NFR-001.

**Критично для бизнеса:** Да — без горизонтального масштабирования невозможен переход от Early Adopters к Enterprise.

**Метод проверки:** Нагрузочный тест k6 200 VU, 60 мин; мониторинг автоматического масштабирования HPA в staging.

**Конфликты:** Нет.

---

#### NFR-014: Изоляция тенантов и мультитенантность

**Категория:** Масштабируемость

**Формулировка:**
- **Free/Pro:** PostgreSQL RLS (`app.current_org_id` session variable); Qdrant — отдельная коллекция `org_{id}_docs` на организацию; S3 — префикс `/org/{id}/`.
- **Enterprise:** отдельная PostgreSQL schema (`tenant_{id}`) или выделенный инстанс; выделенный S3 bucket; изолированная Qdrant коллекция.
- **On-premise:** полная изоляция в контуре клиента.
- Максимальное число организаций в shared-инстансе: ≥ 10 000 (тест RLS при 10 000 организаций и 1 млн записей `presentations`).

**Критично для бизнеса:** Да — утечка данных между тенантами — критический инцидент репутационного риска.

**Метод проверки:** Security-тест: запрос с `org_id = A` не должен возвращать данные `org_id = B` при любых условиях; penetration test RLS bypass.

**Конфликты:** NFR-004 (дополнительная изоляция = дополнительные ресурсы для Enterprise).

---

#### NFR-015: Ёмкость векторного хранилища

**Категория:** Масштабируемость

**Формулировка:**
- Qdrant должен поддерживать ≥ 10 000 000 векторов в shared-инстансе без деградации p95 latency поиска выше 100 мс (при top_k=8, фильтр по `source_document_id`).
- При росте > 10 млн векторов — horizontal sharding Qdrant: автоматическое распределение коллекций по нескольким нодам.
- TTL-очистка: чанки документов без активных `presentation_sources` > 90 дней удаляются фоновым job'ом еженедельно.

**Критично для бизнеса:** Нет (актуально при 100 000+ MAU).

**Метод проверки:** Нагрузочный тест Qdrant с 10 млн синтетических векторов; измерение p95 latency поиска.

**Конфликты:** Нет.

---

## Совместимость

#### NFR-016: Браузеры и устройства

**Категория:** Совместимость

**Формулировка:** Web-приложение (Next.js) должно корректно работать в:
- **Desktop браузеры:** Chrome ≥ 110, Firefox ≥ 110, Safari ≥ 16, Edge ≥ 110.
- **Мобильные браузеры:** Chrome для Android ≥ 110, Safari для iOS ≥ 16 (iPad и iPhone).
- **Разрешения:** от 375×667 px (iPhone SE) до 2560×1440 px. Responsive layout.
- WebSocket (WSS) поддерживается во всех браузерах из списка.
- Функции генерации слайдов доступны на мобильных устройствах (без деградации функциональности).

**Критично для бизнеса:** Нет (основной сценарий — desktop).

**Метод проверки:** E2E-тесты Playwright в матрице browser × viewport; BrowserStack smoke-тест.

**Конфликты:** Нет.

---

#### NFR-017: Версионирование REST API

**Категория:** Совместимость

**Формулировка:**
- Все эндпоинты версионированы: `/api/v1/...`.
- Мажорная версия API сохраняет обратную совместимость в рамках одной версии: добавление полей не является ломающим изменением; удаление полей — только в новой мажорной версии.
- При введении новой версии (v2) предыдущая (v1) поддерживается ≥ 12 месяцев с предупреждением о deprecation.
- Changelog публикуется в документации при каждом изменении API.

**Критично для бизнеса:** Нет (важно для Enterprise-интеграций).

**Метод проверки:** Contract-тесты (Pact) между API Service и клиентами; автоматическая проверка OpenAPI diff в CI.

**Конфликты:** Нет.

---

## Удобство

#### NFR-018: Доступность (Accessibility)

**Категория:** Удобство

**Формулировка:**
- Веб-приложение соответствует WCAG 2.1 Level AA.
- Контрастность текст/фон ≥ 4.5:1 для основного контента; ≥ 3.0:1 для крупного текста (≥ 18pt / 14pt bold).
- Все интерактивные элементы доступны с клавиатуры (Tab, Enter, Space, Escape).
- ARIA-атрибуты корректны для всех динамических компонентов (модальные окна, прогресс-бары, toast-уведомления).

**Критично для бизнеса:** Нет (важно для Enterprise-клиентов с политикой инклюзивности).

**Метод проверки:** axe-core автоматическое тестирование в CI (0 critical violations); ручная проверка screen reader (NVDA/VoiceOver) ключевых flow.

**Конфликты:** NFR-006 (Brand Kit цвета — предупреждение при низком контрасте, но не блокирующая ошибка).

---

#### NFR-019: Количество кликов до ключевого действия

**Категория:** Удобство

**Формулировка:**
- Создание новой презентации (от главной страницы до запуска генерации): ≤ 5 кликов / действий пользователя.
- Экспорт готовой презентации в PPTX: ≤ 3 кликов от страницы готовой презентации.
- Загрузка первого документа: ≤ 3 кликов от создания презентации.

**Критично для бизнеса:** Нет — но напрямую влияет на Time-to-First-Deck (NSM-смежная метрика).

**Метод проверки:** Usability-тест с 5 пользователями из целевого сегмента (PMM/BA); запись сессий Hotjar.

**Конфликты:** Нет.

---

## Правовые и организационные

#### NFR-020: Соответствие 152-ФЗ (Россия)

**Категория:** Правовые

**Формулировка:**
- Персональные данные граждан РФ (email, имя, IP) хранятся **исключительно** на серверах, физически расположенных на территории РФ.
- Трансграничная передача персональных данных граждан РФ в рамках SaaS-версии: не допускается без дополнительного согласия субъекта.
- Срок хранения персональных данных: не более 3 лет после последней активности или удаления аккаунта.
- Уведомление Роскомнадзора об обработке персональных данных выполнено до запуска продукта в РФ.

**Критично для бизнеса:** Да — без 152-ФЗ compliance невозможна работа с российскими Enterprise-клиентами.

**Метод проверки:** Аудит конфигурации инфраструктуры (регион развёртывания); юридическая проверка DPA; тест: данные граждан РФ не реплицируются в EU/US регионы.

**Конфликты:** NFR-021 (GDPR и 152-ФЗ частично конфликтуют в части трансграничной передачи). Решение: раздельные регионы развёртывания (RU-instance и EU-instance), данные не смешиваются.

---

#### NFR-021: Соответствие GDPR (ЕС)

**Категория:** Правовые

**Формулировка:**
- **Right to Erasure (Art. 17):** удаление персональных данных пользователя в течение ≤ 30 суток после запроса (FR-034).
- **Right to Portability (Art. 20):** экспорт данных пользователя в течение ≤ 24 часов (FR-040).
- **Data Processing Agreement (DPA):** заключается со всеми Enterprise-клиентами до начала обработки данных.
- **IP в аналитике:** хранится только `ip_hash = SHA-256(ip + daily_salt)`, не сам IP.
- **Cookie consent:** явное согласие на аналитические cookies перед их установкой.
- **Breach notification:** уведомление регулятора в течение ≤ 72 часов после обнаружения инцидента.

**Критично для бизнеса:** Да — без GDPR compliance невозможна работа с EU Enterprise-клиентами.

**Метод проверки:** GDPR compliance audit (аудитор); функциональный тест Right to Erasure (FR-034 acceptance criteria); мониторинг `ip_hash` в analytics коллекции.

**Конфликты:** NFR-008 (audit log хранит `ip_address` для сессий — допустимо по GDPR как законный интерес безопасности, но ограничивается retention 90 дней).

---

#### NFR-022: Стоимость LLM-операций

**Категория:** Правовые / Организационные

**Формулировка:**
- Средняя стоимость LLM-операций на 1 презентацию (15 слайдов): ≤ $0.15.
- При превышении пользователем среднего потребления токенов в 5× — автоматический алерт (Usage anomaly detection).
- Enterprise soft-лимит: при превышении токенов в 3× от плана — уведомление администратора.
- Semantic cache hit rate: ≥ 15% для outline-запросов (снижает LLM-затраты).
- Целевая unit-экономика: LLM COGS ≤ 30% от выручки на одного пользователя.

**Критично для бизнеса:** Да — LLM API — главная статья COGS; без контроля маржа недостижима.

**Метод проверки:** Дашборд cost/presentation в Grafana; ежедневная сверка LLM-затрат через Anthropic/OpenAI dashboard; Prometheus `llm_cost_per_presentation_usd` histogram.

**Конфликты:** NFR-012 (более тщательный постпроцессинг = больше LLM-вызовов = выше стоимость). Компромисс: постпроцессор использует более дешёвую модель (Claude Haiku / GPT-4o mini).

---

## Матрица конфликтов NFR

| NFR A | NFR B | Конфликт | Принятый компромисс |
|-------|-------|----------|---------------------|
| NFR-001 (latency) | NFR-008 (audit log) | Синхронная запись аудита добавляет I/O | Audit записывается асинхронно через Celery (≤ 500 мс задержка) |
| NFR-001 (latency) | NFR-012 (качество AI) | Постпроцессинг добавляет 500–1000 мс/слайд | Постпроцессор на дешёвой модели (Haiku); latency включена в NFR-002 p95 |
| NFR-012 (качество) | NFR-022 (стоимость) | Fact-check = дополнительные LLM-вызовы | Fact-check через embedding similarity (без LLM-вызова); LLM только при флаге |
| NFR-020 (152-ФЗ) | NFR-021 (GDPR) | Ограничения на трансграничную передачу | Раздельные инстансы RU и EU; данные не смешиваются |
| NFR-006 (шифрование) | NFR-001 (latency) | AES-256-GCM добавляет ≈ 1–3 мс | Допустимо в рамках бюджета latency NFR-001 |
| NFR-009 (uptime 99.5%) | NFR-013 (rolling update) | Rolling update временно снижает capacity | `maxUnavailable: 0` в Kubernetes; HPA компенсирует нагрузку |
